<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="State of mining for CGMiner">
    <meta name="author" content="Jordan Marinov">

    <title>CGMiner Rake</title>

    <!-- Bootstrap core CSS -->
    <link href="/public/css/bootstrap.css" rel="stylesheet">

    <!-- Add custom CSS here -->
    <link href="/public/css/sb-admin.css" rel="stylesheet">
    <link href="/public/css/cgminer-rake.css" rel="stylesheet">
    <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">
    <!-- Page Specific CSS -->
    <link rel="stylesheet" href="http://cdn.oesmith.co.uk/morris-0.4.3.min.css">
  </head>

  <body>

    <div id="wrapper">

      <!-- Sidebar -->
      <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html">CGMiner Rake</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse navbar-ex1-collapse">
          <ul class="nav navbar-nav side-nav">
            <li class="active"><a href="index.html"><i class="fa fa-dashboard"></i> Summary</a></li>
            <li><a href="charts.html"><i class="fa fa-cog"></i> Devices</a></li>
            <li><a href="charts.html"><i class="fa fa-bar-chart-o"></i> Pools</a></li>
          </ul>

          <ul class="nav navbar-nav navbar-right navbar-user">
            <li class="dropdown messages-dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-gift"></span> Donate <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="#">BTC: 1CnLshw9o3vHqJZJWzC48ebjNeLXq13MLM</a></li>
                <li class="divider"></li>
                <li><a href="#">LTC: Lc2ZN8UFZKcSycASZ5vpR47Wj675GCpWPG</a></li>
              </ul>
            </li>
            <li class="dropdown user-dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-user"></i> About <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="#"><i class="fa fa-user"></i> Profile</a></li>
                <li><a href="#"><i class="fa fa-envelope"></i> Inbox <span class="badge">7</span></a></li>
                <li><a href="#"><i class="fa fa-gear"></i> Settings</a></li>
                <li class="divider"></li>
                <li><a href="#"><i class="fa fa-power-off"></i> Log Out</a></li>
              </ul>
            </li>
            <li>&nbsp;</li>
          </ul>
        </div><!-- /.navbar-collapse -->
      </nav>

      <div id="page-wrapper">

        <div class="row">
          <div class="col-lg-12">
            <h1>Summary <small id="cg-version">cgminer n/a</small> <small><a href="#" data-toggle="collapse" data-target="#summary-raw">raw</a></small></h1>
            <div id="summary-raw" class="well raw collapse out"></div>
          </div>
        </div><!-- /.row -->

        <div class="row">
          <div class="col-lg-3">
            <div class="panel panel-info">
              <div class="panel-heading">
                <div class="row">
                  <div class="col-xs-4">
                    <i class="fa fa-check fa-5x"></i>
                  </div>
                  <div class="col-xs-8 text-right">
                    <p class="announcement-heading" id="summary-speed">n/a</p>
                    <p class="announcement-text">MH/s</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-3">
            <div class="panel panel-success">
              <div class="panel-heading">
                <div class="row">
                  <div class="col-xs-4">
                    <i class="fa fa-check fa-5x"></i>
                  </div>
                  <div class="col-xs-8 text-right">
                    <p class="announcement-heading" id="summary-accepted">n/a</p>
                    <p class="announcement-text">Accepted Shares</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-3">
            <div class="panel panel-warning">
              <div class="panel-heading">
                <div class="row">
                  <div class="col-xs-4">
                    <i class="fa fa-times fa-5x"></i>
                  </div>
                  <div class="col-xs-8 text-right">
                    <p class="announcement-heading" id="summary-rejected">n/a</p>
                    <p class="announcement-text">Rejected Shares</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-3">
            <div class="panel panel-danger">
              <div class="panel-heading">
                <div class="row">
                  <div class="col-xs-4">
                    <i class="fa fa-cog fa-5x"></i>
                  </div>
                  <div class="col-xs-8 text-right">
                    <p class="announcement-heading" id="summary-hardware">n/a</p>
                    <p class="announcement-text">Hardware Errors</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div><!-- /.row -->

        <div class="row">
          <div class="col-lg-12">
            <div class="panel panel-primary">
              <div class="panel-heading">
                <h3 class="panel-title"><i class="fa fa-bar-chart-o"></i> Average mining speed: MH/s</h3>
              </div>
              <div class="panel-body">
                <div class="flot-chart">
                  <div class="flot-chart-content" id="flot-chart-moving-line"></div>
                </div>
              </div>
            </div>
          </div>
        </div><!-- /.row -->

        <div class="row">
          <div class="col-lg-12">
            <h1>Devices <small id="devices-count">3</small></h1>
            <div id="summary-raw" class="well raw collapse out"></div>
          </div>
        </div><!-- /.row -->

        <div class="row">
          <div class="col-lg-12">
            <h1>Pools <small id="pools-count">3</small></h1>
            <div id="summary-raw" class="well raw collapse out"></div>
          </div>
        </div><!-- /.row -->

      </div><!-- /#page-wrapper -->

    </div><!-- /#wrapper -->

    <!-- JavaScript -->
    <script src="/public/js/jquery-1.10.2.js"></script>
    <script src="/public/js/bootstrap.js"></script>

    <!-- Page Specific Plugins -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
    <script src="http://cdn.oesmith.co.uk/morris-0.4.3.min.js"></script>
    <script src="/public/js/morris/chart-data-morris.js"></script>
    <script src="/public/js/tablesorter/jquery.tablesorter.js"></script>
    <script src="/public/js/tablesorter/tables.js"></script>
    <script src="/public/js/flot/jquery.flot.js"></script>
    <script src="/public/js/flot/jquery.flot.tooltip.min.js"></script>
    <script src="/public/js/flot/jquery.flot.resize.js"></script>
    <script src="/public/js/flot/jquery.flot.pie.js"></script>

    <script type="text/javascript" src="/public/js/renders.js"></script>

    <script type="text/javascript">

      function renderSummary(data) {
        $("#cg-version").html(data.STATUS[0].Description);
        $("#summary-speed").html(Math.round(data.SUMMARY[0]["MHS 5s"]));
        $("#summary-accepted").html(data.SUMMARY[0]["Accepted"]);
        $("#summary-rejected").html(data.SUMMARY[0]["Rejected"]);
        $("#summary-hardware").html(data.SUMMARY[0]["Hardware Errors"]);
        $("#summary-raw").text(JSON.stringify(data, null, 4));
      }

      function readCgMiner() {

          $.get('summary.json', function(data) {
            renderSummary(data)
          });

          $.get('devices.json', function(data) {
            var devicesHtml = "";
            $.each(data, function( index, value ) {
              //devicesHtml += prettyPrint(value);
            });
            $("#devices").html(prettyPrint(data));
          });

      }

      $(function () {

        var interval = 2000;

        var container = $("#flot-chart-moving-line");

        // Determine how many data points to keep based on the placeholder's initial size;
        // this gives us a nice high-res plot while avoiding more than one point per pixel.

        var maximum = container.outerWidth() / 2 || 300;

        //

        var data = [];

        function getRandomData() {

            if (data.length) {
                data = data.slice(1);
            }

            while (data.length < maximum) {
                var previous = data.length ? data[data.length - 1] : 50;
                var y = previous + Math.random() * 10 - 5;
                data.push(y < 0 ? 0 : y > 100 ? 100 : y);
            }

            // zip the generated y values with the x values

            var res = [];
            for (var i = 0; i < data.length; ++i) {
                res.push([i, data[i]])
            }

            return res;
        }

        //

        series = [{
          data: getRandomData(),
          lines: {
            fill: true
          }
        }];

        //

        var plot = $.plot(container, series, {
          grid: {
            borderWidth: 1,
            minBorderMargin: 20,
            labelMargin: 10,
            backgroundColor: {
              colors: ["#fff", "#e4f4f4"]
            },
            margin: {
              top: 8,
              bottom: 20,
              left: 20
            },
            markings: function(axes) {
              var markings = [];
              var xaxis = axes.xaxis;
              for (var x = Math.floor(xaxis.min); x < xaxis.max; x += xaxis.tickSize * 2) {
                markings.push({ xaxis: { from: x, to: x + xaxis.tickSize }, color: "rgba(232, 232, 255, 0.2)" });
              }
              return markings;
            }
          },
          xaxis: {
            tickFormatter: function() {
              return "";
            }
          },
          yaxis: {
            min: 0
          },
          legend: {
            show: true
          }
        });

        // Update the random dataset at 25FPS for a smoothly-animating chart

        setInterval(readCgMiner(), interval);

        setInterval(function updateRandom() {
          series[0].data = getRandomData();
          plot.setData(series);
          plot.draw();
        }, 40);

      });
    </script>

  </body>
</html>
